# TODO

## 目标与范围
- [ ] 让“星露谷物语”的农场在单机存档中实现“自己运转”，在雨天与节日智能切换并保持资源平衡

## 用户故事（核心场景）
- [x] 早上起床后自动浇水/收获/播种，并在晚上自己回床睡觉
- [x] 雨天自动跳过浇水
- [x] 背包快满时自动回仓分类存放
- [x] 当体力低或时间晚时自动返家
- [ ] 提供“日程面板”一键启停、查看队列、临时插队
- [ ] 支持配置作物清单与优先级、季度种植计划、路径锚点

## 功能清单
### A. 每日日程与策略
- [x] 日程生成器按季节/天气/时间生成计划
- [x] 晴天日程：浇水→收获→播种/施肥→回家
- [x] 雨天跳过浇水，切换其它任务
- [ ] 节日/市集模式切换
- [x] 截止策略：21:00规划返程、23:30强制返家、体力阈值触发回家

### B. 农活自动化
- [x] 浇水：检测地块并自动寻路浇水
- [x] 收获：识别成熟作物并收集
- [x] 耕地与播种：匹配当季种子并施肥
- [ ] 喷头布局辅助

### C. 仓储与补给
- [x] 智能存仓：按类别放入对应箱子
- [ ] 补给采购：在商店营业时间购买所需物资
- [ ] 吃食物/回复体力

### D. 路径与移动
- [ ] 寻路：使用PathFindController或A*记录常用锚点
- [ ] 交通效率：解锁后使用马、矿车等

### E. 社交与日历（可选）
- [ ] 礼物清单与生日计划
- [ ] 节日模式：任务调整或停工

### F. 矿洞与战斗（可选）
- [ ] 安全策略：血量体力低撤离、背包满返程
- [ ] 层数目标与梯子识别

### G. 日志、可视化与面板
- [ ] HUD 面板：今日计划与状态
- [ ] 任务队列查看与插队
- [ ] 运行日志导出

### H. 配置与黑板
- [x] 黑板数据：地块快照、箱子清单、路径锚点
- [ ] 策略配置：体力阈值、返家时间、预算等
- [ ] 配置热加载

### I. 失败恢复与安全
- [ ] 卡路检测与路径重算
- [ ] 动作失败时的任务切换或补给
- [x] 保底：23:30无条件返家

## 非功能需求
- [ ] 性能：每帧逻辑轻量、规划分批执行
- [ ] 兼容性：与主流模组兼容并提供冲突列表
- [ ] 可扩展：统一任务接口，允许第三方注入
- [ ] 可测试性：在无渲染环境下单元测试
- [ ] 可审计：提供调试开关与详细日志

## 版本分层
### MVP（首版必达）
- [x] 自动：浇水→收获→播种→回家睡觉
- [x] 背包满智能存仓
- [x] 体力/时间阈值返家
- [x] 雨天不浇水
- [ ] HUD 面板（简版）
- [ ] 日志（简版）
- [x] 黑板：地块快照、箱子锚点、关键路径点

### V1.0（实用稳定）
- [ ] 补给采购与预算
- [ ] 社交简表
- [ ] 交通效率：马/矿车
- [ ] 失败恢复与卡路检测
- [ ] 配置热加载与任务插队

### 进阶/专家
- [ ] 季度种植计划与ROI建议
- [ ] 温室/喷头布局建议报告
- [ ] 矿洞轻量版
- [ ] 钓鱼（保守策略）
- [ ] 数据导出与可视化

## 对外接口
- [ ] 任务接口：CanExecute/Cost/Apply/Execute
- [ ] 事件总线：OnDailyPlanBuilt等
- [x] 黑板存取接口

## 验收标准
- [ ] 连续7天无人干预无昏倒、不卡死、无异常支出
- [ ] 浇水/收获/播种正确率≥99%
- [ ] 23:30前回家成功率100%
- [ ] 背包满存仓成功率≥98%
- [ ] 雨天浇水动作次数=0

## 风险与回避
- [ ] 地图改造导致路径失效：提供手动锚点标定
- [ ] 商店或节日交易失败：备选任务与明日重试
- [ ] 性能问题：扫描分批分帧、日志HUD可降级
